#!/bin/bash

yabai -m display --focus next || yabai -m display --focus prev
# if the active/focused space on the targeted display is empty the mouse follows for some reason;
# so the cursor moves to the middle of the display (including sketchybar) and the regarding correction of 19px is applied after, which leads to a small movement (/delay).
# perhaps the bar-compensation of yabai fixes this? NO... --- and "When switching to an application, switch to a Space with open windows for the application" is essential.
# same in quit_script with "yabai -m space --focus $CURRENT_SPACE"
sleep 0.01
if [[ $(yabai -m query --displays --display | jq -r '."uuid"') == "37D8832A-2D66-02CA-B9F7-8F30A301B230" ]]; then
    cliclick $(yabai -m query --displays --display | jq -r '.frame | "m:\(.x + (.w/2) | floor),\(.y + (.h/2) + 19 | floor)"')
else
    cliclick $(yabai -m query --displays --display | jq -r '.frame | "m:\(.x + (.w/2) | floor),\(.y + (.h/2) | floor)"')
fi
sleep 0.01
yabai -m window --focus mouse || (cliclick c:. && osascript -e 'tell application "System Events" to set visible of every process whose visible is false to true')
sleep 0.01
skhd -k "fn - x"
sleep 0.1
sketchybar --update
